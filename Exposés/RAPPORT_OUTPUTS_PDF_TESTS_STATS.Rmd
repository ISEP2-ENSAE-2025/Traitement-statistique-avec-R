---

title: "Rapport d’analyse – Consommation alimentaire par zone"

author: "RIRADJIM NGARMOUNDOU Trésor"

institute: "École Nationale de la Statistique et de l'Analyse Économique de Dakar"

date: "`r format(Sys.Date(), '%d %B %Y')`"

output:
beamer\_presentation:
slide\_level: 2
theme: "Madrid"
colortheme: "dolphin"
toc: true
number\_sections: true
header-includes:
  - |
    \setbeamercolor{structure}{fg=green!60!black}
  - |
    \setbeamercolor{palette primary}{use=structure,fg=white,bg=green!60!black}
  - |
    \setbeamercolor{frametitle}{bg=green!60!black,fg=white}
  - |
    \setbeamercolor{title}{bg=white,fg=green!60!black}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
library(haven)
library(dplyr)
library(ggplot2)
library(car)
library(rstatix)
library(kSamples)
```

```{r data-prep, echo=FALSE}
# 1. Chemins
zip_path <- "/Users/HP/Downloads/SEN2018_menage.zip"
out_dir  <- "/Users/HP/Downloads/SEN2018_menage"

# 2. Extraction
if (!dir.exists(out_dir) && file.exists(zip_path)) {
  unzip(zipfile = zip_path, exdir = out_dir)
}

# 3. Lecture .dta
dta_files <- list.files(out_dir, pattern = "\\.dta$", full.names = TRUE, recursive = TRUE)
liste_data <- setNames(lapply(dta_files, haven::read_dta), basename(dta_files))

# 4. Création ID et fusion
df_list <- lapply(liste_data, function(df) df %>% mutate(id = paste(grappe, menage, sep = "_")))

tbl_zone <- df_list[["s00_me_SEN2018.dta"]] %>%
  select(id, s00q04) %>%
  rename(zone_code = s00q04) %>%
  mutate(zone = ifelse(zone_code == 1, "Urbaine", "Rurale")) %>%
  select(id, zone)

tbl_conso_raw <- df_list[["s08b1_me_SEN2018.dta"]]
food_vars <- grep("^s08b02", names(tbl_conso_raw), value = TRUE)
tbl_conso <- tbl_conso_raw %>%
  select(id, all_of(food_vars)) %>%
  mutate(conso_total = rowSums(across(all_of(food_vars)), na.rm = TRUE)) %>%
  select(id, conso_total)

df <- inner_join(tbl_conso, tbl_zone, by = "id") %>%
  filter(conso_total > 0)
```

# Analyse des tests statistiques

## Visualisation avec boxplot

Le diagramme en boîte (boxplot) permet une première exploration visuelle des différences entre les zones. On observe que la médiane de la consommation alimentaire est plus élevée en zone urbaine qu'en zone rurale. De plus, la dispersion semble plus importante en zone rurale, avec quelques valeurs extrêmes visibles. Cela suggère des différences de structure dans les distributions de consommation.

```{r boxplot}
ggplot(df, aes(zone, conso_total)) +
  geom_boxplot(fill = 'lightgreen') +
  labs(title = 'Consommation par zone', x = 'Zone', y = 'Conso totale')
```

## Test de Shapiro-Wilk

Ce test permet de vérifier la normalité des distributions dans chaque groupe. Les p-valeurs obtenues étant inférieures à 0,05, on rejette l'hypothèse de normalité dans les deux zones. Cela justifie le recours à des tests non paramétriques par la suite.

**Résultat :**

```{r}
shapiro.test(df$conso_total[df$zone == "Urbaine"])
shapiro.test(df$conso_total[df$zone == "Rurale"])
```

## Test de Levene

Ce test évalue l’homogénéité des variances. Le résultat montre une différence significative entre les variances des deux groupes (zones), indiquant une hétéroscédasticité. Cela confirme que les conditions d’un test paramétrique comme l’ANOVA classique ne sont pas réunies.

**Résultat :**

```{r}
leveneTest(conso_total ~ zone, data = df)
```

## Test de Wilcoxon (Mann-Whitney)

Test non paramétrique qui compare les distributions. Il révèle une différence significative entre les zones urbaine et rurale. Cela suggère une disparité dans les niveaux de consommation alimentaire totale entre ces zones.

**Résultat :**

```{r}
wilcox.test(conso_total ~ zone, data = df)
```

## Taille de l’effet (Cohen’s d)

La taille de l’effet est faible, indiquant que même si la différence est statistiquement significative, son ampleur reste modérée. Cela peut s’expliquer par une forte variabilité intra-groupe.

**Résultat :**

```{r}
cohens_d(df, conso_total ~ zone)
```

## Test de Kolmogorov-Smirnov (KS)

Ce test compare les distributions empiriques des deux groupes. Le résultat est significatif, ce qui confirme que les distributions sont différentes entre zones.

**Résultat :**

```{r}
ks.test(df$conso_total[df$zone=='Urbaine'], df$conso_total[df$zone=='Rurale'])
```

## Test d’Anderson-Darling

Ce test affine la comparaison des distributions. Le résultat corrobore celui du test KS, renforçant l’idée d’une différence de forme entre les distributions urbaines et rurales.

**Résultat :**

```{r}
ad.test(conso_total ~ zone, data = df)
```

## Test de permutation

Le test de permutation valide également la différence observée entre les distributions. Il renforce les résultats obtenus précédemment, sans faire d’hypothèse sur la distribution des données.

**Résultat :**

```{r}
obs <- max(abs(
  ecdf(df$conso_total[df$zone=='Urbaine'])(df$conso_total[df$zone=='Rurale']) -
  ecdf(df$conso_total[df$zone=='Rurale'])(df$conso_total[df$zone=='Urbaine'])
))
perm <- replicate(2000, {
  z <- sample(df$zone)
  max(abs(
    ecdf(df$conso_total[z=='Urbaine'])(df$conso_total[z=='Rurale']) -
    ecdf(df$conso_total[z=='Rurale'])(df$conso_total[z=='Urbaine'])
  ))
})
mean(perm >= obs)
```

## Test du Chi-deux

En transformant la variable continue en catégories (terciles), le test du Chi-deux permet d’évaluer l’indépendance entre zone et niveau de consommation. Le résultat est significatif, avec un faible effet de Phi², ce qui indique une association modérée.

**Résultat :**

```{r}
df2 <- df %>% mutate(cat = ntile(conso_total, 3))
tab <- table(df2$cat, df2$zone)
chisq.test(tab)
```

## ANOVA (analyse de la variance)

Bien que les conditions ne soient pas parfaitement remplies (non-normalité, variances inégales), l’ANOVA est réalisée à titre indicatif. Les résultats montrent une différence significative mais avec un faible eta², ce qui indique une variance expliquée limitée par le facteur "zone".

**Résultat :**

```{r}
aov_res <- aov(conso_total ~ zone, data = df)
summary(aov_res)
eta_squared(aov_res)
```

# Conclusion

* Les distributions de consommation diffèrent significativement entre zones.
* La zone géographique influence la consommation, mais l’effet reste modéré.
* L’analyse multivariée future pourrait aider à mieux comprendre ces différences en tenant compte d’autres variables explicatives.
