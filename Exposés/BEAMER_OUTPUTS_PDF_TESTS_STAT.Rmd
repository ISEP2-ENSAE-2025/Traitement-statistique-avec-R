---

title: "Rapport d’analyse – Consommation alimentaire par zone"

author: "RIRADJIM NGARMOUNDOU Trésor"

institute: "École Nationale de la Statistique et de l'Analyse Économique de Dakar"

date: "`r format(Sys.Date(), '%d %B %Y')`"

output:
beamer\_presentation:
slide\_level: 2

theme: "Madrid"
colortheme: "dolphin"
toc: true
number\_sections: true
header-includes:
  - |
    \setbeamercolor{structure}{fg=green!60!black}
  - |
    \setbeamercolor{palette primary}{use=structure,fg=white,bg=green!60!black}
  - |
    \setbeamercolor{frametitle}{bg=green!60!black,fg=white}
  - |
    \setbeamercolor{title}{bg=white,fg=green!60!black}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
library(haven)
library(dplyr)
library(ggplot2)
library(car)
library(rstatix)
library(kSamples)
```

```{r data-prep, echo=FALSE}
# 1. Définir chemins
zip_path <- "/Users/HP/Downloads/SEN2018_menage.zip"
out_dir  <- "/Users/HP/Downloads/SEN2018_menage"

# 2. Extraction
if (!dir.exists(out_dir) && file.exists(zip_path)) {
  utils::unzip(zipfile = zip_path, exdir = out_dir)
}

# 3. Lecture .dta
dta_files <- list.files(out_dir, pattern = "\\.dta$", full.names = TRUE, recursive = TRUE)
liste_data <- setNames(lapply(dta_files, haven::read_dta), basename(dta_files))

# 4. Construction de df
# 4.1 Création ID
df_list <- lapply(liste_data, function(df) df %>% mutate(id = paste(grappe, menage, sep = "_")))
# 4.2 Zone
tbl_zone <- df_list[["s00_me_SEN2018.dta"]] %>%
  select(id, s00q04) %>%
  rename(zone_code = s00q04) %>%
  mutate(zone = ifelse(zone_code == 1, "Urbaine", "Rurale")) %>%
  select(id, zone)
# 4.3 Consommation
tbl_conso_raw <- df_list[["s08b1_me_SEN2018.dta"]]
food_vars <- grep("^s08b02", names(tbl_conso_raw), value = TRUE)
tbl_conso <- tbl_conso_raw %>%
  select(id, all_of(food_vars)) %>%
  mutate(conso_total = rowSums(across(all_of(food_vars)), na.rm = TRUE)) %>%
  select(id, conso_total)
# 4.4 Fusion & filtre
library(dplyr)
df <- inner_join(tbl_conso, tbl_zone, by = "id") %>%
  filter(conso_total > 0)
```

# Introduction

* **Objectif** : comparer la consommation alimentaire totale entre zones urbaines et rurales.

# Méthodes

1. Construction et nettoyage du jeu de données
2. Analyse descriptive
3. Tests statistiques

# Analyse descriptive

```{r descriptives}
# Statistiques de base
stats <- df %>% group_by(zone) %>%
  summarise(n = n(), moyenne = mean(conso_total), sd = sd(conso_total))
print(stats)

# Boxplot
ggplot(df, aes(zone, conso_total)) +
  geom_boxplot(fill = 'lightgreen') +
  labs(title = 'Consommation par zone', x = 'Zone', y = 'Conso totale')
```

# Tests statistiques

## Shapiro-Wilk

```{r normality}
sh_u <- shapiro.test(df$conso_total[df$zone=='Urbaine'])
sh_r <- shapiro.test(df$conso_total[df$zone=='Rurale'])
sh_u; sh_r
```

## Levene

```{r levene}
res_levene <- leveneTest(conso_total ~ zone, data = df)
res_levene
```

## Wilcoxon

```{r wilcox}
res_wilcox <- wilcox.test(conso_total ~ zone, data = df)
res_wilcox
```

## Cohen's d

```{r cohen}
res_d <- cohens_d(df, conso_total ~ zone)
res_d
```

## KS test

```{r ks}
res_ks <- ks.test(
  df$conso_total[df$zone=='Urbaine'],
  df$conso_total[df$zone=='Rurale']
)
res_ks
```

## Anderson-Darling

```{r ad}
ad_res <- ad.test(conso_total ~ zone, data = df)
ad_res
```

## Permutation

```{r perm}
obs <- max(abs(
  ecdf(df$conso_total[df$zone=='Urbaine'])(df$conso_total[df$zone=='Rurale']) -
  ecdf(df$conso_total[df$zone=='Rurale'])(df$conso_total[df$zone=='Urbaine'])
))
perm <- replicate(2000, {
  z <- sample(df$zone)
  max(abs(
    ecdf(df$conso_total[z=='Urbaine'])(df$conso_total[z=='Rurale']) -
    ecdf(df$conso_total[z=='Rurale'])(df$conso_total[z=='Urbaine'])
  ))
})
p_perm <- mean(perm >= obs)
cat('p_perm =', p_perm)
```

## Chi-squared

```{r chi2}
df2 <- df %>% mutate(cat = ntile(conso_total, 3))
tab <- table(df2$cat, df2$zone)
res_chi2 <- chisq.test(tab)
phi2 <- res_chi2$statistic / sum(tab)
res_chi2; phi2
```

## ANOVA

```{r anova}
aov_res <- aov(conso_total ~ zone, data = df)
summary(aov_res)
eta_squared(aov_res)
```

# Conclusion

* Distributions non normales, variances hétérogènes
* Différences de médianes et distributions significatives
* Effets de faible ampleur

# Perspectives

* Modèles multivariés
* Analyse par catégorie d’aliments
* Études longitudinales
